# 策略更新说明 - 动量守恒增强版

**更新日期**: 2025-11-24

---

## 主要变更

### 1. 删除策略
- ❌ **趋势延续策略 (trend_continuation)** - 已完全移除

### 2. 新增策略
- ✅ **动量守恒增强版 (volume_wave_enhanced)** - 新增

---

## 策略详情

### 动量守恒增强版 (volume_wave_enhanced)

**策略代码**: `volume_wave_enhanced`  
**策略名称**: 动量守恒增强版  
**置信度**: 0.88

#### 策略逻辑

1. **基础逻辑**：与动量守恒策略完全相同
   - 使用 Angel 线 (EMA2) 和 Devil 线的交叉判断买卖信号
   - 计算线性回归斜率辅助判断趋势

2. **增强过滤**：买入信号额外要求
   - ⭐ **价格必须大于 EMA18**
   - 这个过滤条件确保只在趋势向上时买入

3. **卖出信号**：保持不变
   - 卖出信号不受 EMA18 影响

#### 与动量守恒的对比

| 特性 | 动量守恒 (volume_wave) | 动量守恒增强版 (volume_wave_enhanced) |
|------|----------------------|-----------------------------------|
| 买卖计算逻辑 | Angel × Devil | Angel × Devil |
| 买入过滤条件 | 无 | 价格 > EMA18 |
| 卖出过滤条件 | 无 | 无 |
| 置信度 | 0.85 | 0.88 |
| 信号数量 | 较多 | 较少（更精准） |

---

## 技术实现

### 文件结构

#### 新增文件
```
stock_app_service/app/indicators/volume_wave_enhanced_strategy.py
stock_app_service/app/charts/volume_wave_enhanced_chart_strategy.py
```

#### 删除文件
```
stock_app_service/app/indicators/trend_continuation_strategy.py
stock_app_service/app/charts/trend_continuation_chart_strategy.py
stock_app_service/scripts/test_trend_continuation_performance.py
stock_app_service/docs/趋势延续策略性能优化说明.md
```

#### 修改文件
```
stock_app_service/app/indicators/__init__.py          # 策略注册
stock_app_service/app/charts/__init__.py              # 图表策略注册
stock_app_service/app/services/signal/signal_manager.py  # 置信度配置
stock_app_service/app/api/signal_management.py        # API接口
stock_app_service/app/api/chart.py                    # 图表API
stock_app_service/app/charts/volume_wave_chart_strategy.py  # 隐藏策略描述
```

---

## UI 改进

### 图表左下角
- ✅ **策略描述已隐藏**
- 现在图表左下角只显示股票信息，不再显示策略说明文字
- 适用于所有策略（动量守恒、动量守恒增强版）

---

## API 变更

### 买入信号 API
```
GET /api/stocks/signal/buy?strategy=volume_wave_enhanced
```

支持的策略参数：
- `volume_wave` - 动量守恒
- `volume_wave_enhanced` - 动量守恒增强版

### 图表生成 API
```
GET /api/stocks/{stock_code}/chart?strategy=volume_wave_enhanced&theme=dark
```

支持的策略参数：
- `volume_wave` - 动量守恒
- `volume_wave_enhanced` - 动量守恒增强版

---

## 使用建议

### 何时使用动量守恒
- 想要捕捉所有可能的机会
- 能够接受更多的假信号
- 适合激进型交易者

### 何时使用动量守恒增强版
- 想要更高质量的信号
- 只在明确上升趋势中交易
- 适合稳健型交易者

---

## 迁移指南

如果您之前使用的是 `trend_continuation` 策略：

1. **信号计算**
   ```bash
   # 旧方式（已废弃）
   strategy = "trend_continuation"
   
   # 新方式
   strategy = "volume_wave_enhanced"  # 推荐
   # 或
   strategy = "volume_wave"           # 信号更多
   ```

2. **前端代码**
   - 将所有 `trend_continuation` 改为 `volume_wave_enhanced` 或 `volume_wave`

3. **数据清理**
   - 建议重新计算买入信号以清除旧的 trend_continuation 信号

---

## 注意事项

1. ⚠️ 旧的信号数据可能包含 `trend_continuation`，建议重新计算信号
2. ✅ 新策略已完全集成，可以立即使用
3. ✅ 所有 API 接口已更新，不再支持 `trend_continuation`

---

## 测试建议

1. 在小范围测试增强版策略的信号质量
2. 对比动量守恒和增强版的信号差异
3. 根据实际效果选择合适的策略

