# 紧凑版K线图功能说明

## 功能概述

在添加交易计划页面的止损止盈填写区域，新增了一个紧凑版的K线走势图，让用户在设置止损止盈价格时能够更直观地看到价格位置。

## 主要特性

### 1. 自动显示
- 当选择股票并加载历史数据后，紧凑版K线图会自动出现在止损止盈输入框的上方
- 图表展示最近的K线走势数据

### 2. 实时价格线标注
紧凑版K线图会实时显示三条重要的价格线：

- **蓝色虚线**：入场价格（从"入场价格"输入框读取）
- **绿色虚线**：止损价格（从"止损价格"输入框读取）
- **红色虚线**：止盈价格（从"止盈价格"输入框读取）

### 3. 动态更新
- 当您在止损或止盈输入框中修改价格时，图表上的价格线会实时更新
- 这让您能够立即看到新的止损止盈位置是否合理

### 4. 图表功能
- **触摸交互**：点击图表可以查看具体日期的价格信息
- **价格标签**：每条价格线右侧显示具体数值
- **图例说明**：图表顶部显示入场、止损、止盈的颜色图例

## 使用场景

### 场景1：设置止损价格
1. 输入股票代码，系统自动加载K线数据
2. 查看紧凑版K线图，找到合适的支撑位
3. 在止损输入框中填写价格
4. 观察图表上的绿色止损线位置是否合理

### 场景2：设置止盈价格
1. 在紧凑版K线图上观察前期的阻力位
2. 在止盈输入框中填写目标价格
3. 观察图表上的红色止盈线位置
4. 确保盈亏比符合要求（查看下方的盈亏比显示）

### 场景3：调整价格位置
1. 如果发现止损线太接近当前价格（容易被震出）
2. 直接在输入框中调整价格
3. 实时观察图表上的线条移动
4. 找到最佳的止损位置

## 技术优势

1. **轻量化设计**：图表高度仅180px，不占用过多屏幕空间
2. **关键信息聚焦**：只显示收盘价线和关键价格标注，避免信息过载
3. **自适应范围**：图表的Y轴范围会自动调整，确保所有价格线都在可见范围内
4. **深色模式支持**：图表会根据系统主题自动调整颜色

## 与完整K线图的区别

| 特性 | 完整K线图（页面顶部） | 紧凑版K线图（止损止盈区） |
|------|---------------------|------------------------|
| 位置 | 页面顶部 | 止损止盈输入框上方 |
| 高度 | 300px | 180px |
| 显示内容 | 收盘价线 + 5日/17日EMA | 仅收盘价线 |
| 价格线标注 | 无 | 入场/止损/止盈三条线 |
| 用途 | 整体趋势分析 | 精确设置止损止盈 |
| 可折叠 | 是（可隐藏） | 否（始终显示） |

## 设计理念

该功能的设计遵循以下原则：

1. **就近原则**：将K线图放在止损止盈输入框附近，减少视线移动
2. **实时反馈**：输入价格后立即在图表上显示，所见即所得
3. **简洁明了**：只显示最关键的信息，避免干扰用户决策
4. **视觉引导**：用不同颜色区分入场、止损、止盈，符合交易习惯

## 注意事项

1. 紧凑版K线图仅在选择股票并成功加载历史数据后才会显示
2. 如果历史数据为空，图表会自动隐藏
3. 价格线的显示取决于对应输入框是否有有效数值
4. 图表会自动扩展Y轴范围以包含所有价格线

## 后续优化方向

1. 可以考虑添加更多技术指标（如均线、布林带等）
2. 支持用户在图表上直接拖动价格线来调整止损止盈
3. 增加价格区间的风险提示（如止损距离过近时高亮显示）
4. 支持放大/缩小时间周期

---

**开发日期**：2025-12-18
**功能模块**：添加交易计划页面
**影响文件**：`lib/screens/add_trade_screen.dart`

